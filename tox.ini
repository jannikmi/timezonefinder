[tox]
isolated_build = true
envlist =
    # TODO python 3.13 with numba
    integration,docs,py{39,310,311,312}{,-numba,-pytz},py313{,-pytz}

[testenv]
# specify `BUILD_CFFI` to uv commands explicitly instead of use `set_env`
# and using at the same time
allowlist_externals = uv, env
# run 'examples' mark only on full installation with pytz
commands =
    !numba: env BUILD_CFFI=true uv run -v pytest  -m "not integration and not examples" {posargs}
    numba:  env BUILD_CFFI=true uv run -v --group numba pytest -m "not integration and not examples" {posargs}
    pytz:   env BUILD_CFFI=true uv run -v --group pytz pytest  -m "not integration" {posargs}

[testenv:integration]
description = run integration tests only
# run expensive integration tests only once (includes building sdist and wheel)
basepython = python3.13
allowlist_externals = uv, env
commands =
    env BUILD_CFFI=true uv run -v pytest -m "integration" {posargs}

[testenv:docs]
description = build documentation
basepython = python3.12
allowlist_externals = uv,sphinx-build,env
commands =
    env BUILD_CFFI=true uv run -v --group docs python3 --version
    sphinx-build -d "{envtmpdir}{/}doctree" docs "{toxworkdir}{/}docs_out" --color -b html
    python -c 'print(r"documentation available under file://{toxworkdir}{/}docs_out{/}index.html")'
